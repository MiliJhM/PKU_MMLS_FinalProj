% filename main.m
% Main function to init
% {default min max }
%to avoid additional offspring when using large drive_conversion and germline_resistance_forming, the real drive conversion = (1-germline_resistance_forming)*drive_conversion
plistlist = struct( ...
    'drive_conversion', {0.8,0.0, 1.0}, ...
    'drive_fitness', {0.9,0.1, 1.0}, ...
    'release_rate', {0.001,0.001, 0.5}, ...
    'germline_resistance_forming', {0.1,0.0, 1}, ...
    'dd_mothertal_inheritance', {0.05,0.0, 0.5},...
    'log_immunity_speed', {0,-1,1},...
    'reducehtm',{0.5,0,1}...
    );
phumanlist = struct( ...
    'human_recovery', {0.030673973459249}, ...
    'mtoh', {0.110070995896335}, ...
    'immunity_gain_rate', {0.086442942066365}, ...
    'immunity_losing_rate', {0.001545980207871}, ...
    'b1', {0.801405190261370},...
    'shape',{2.013061848936364}...
    );

pmosquitolist = struct( ...
    'capacity', {29}, ...
    'reproduction_rate', {0.5}, ...
    'htom', {0.2} ...
    );

EIRS=[3.748022899,4.209665958,20.302014,19.46226874,37.85310084,68.37694864,41.62689645,67.65891383,92.87530606,128.8428103,126.1500306,157.4671712,198.6464579,209.4149771,240.2292953,169.5482093,159.1395626,162.5352447];
EIRS=reshape(EIRS,length(EIRS),1);
prevalences=[0.02769617,0.167517702,0.098683032,0.283678023,0.25356346,0.268620741,0.612798931,0.511697506,0.470825206,0.685937987,0.617101703,0.59559107,0.580532176,0.552568192,0.602044422,0.806399466,0.892445223,0.944072032];
prevalences=reshape(prevalences,length(prevalences),1);

%to find a reasonable parameter set for human
findhuman=true;
if findhuman
    for i =1:1
        p=spacial('nooutputfile', plistlist(1),phumanlist,pmosquitolist,EIRS,prevalences,false,false,true,false);
    phumanlist1 = struct( ...
    'human_recovery', {phumanlist.human_recovery*1.001}, ...
    'mtoh', {phumanlist.mtoh}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate}, ...,
    'b1', {phumanlist.b1},...
    'shape',{phumanlist.shape}...
    );
    phumanlist2 = struct( ...
    'human_recovery', {phumanlist.human_recovery}, ...
    'mtoh', {phumanlist.mtoh*1.001}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate}, ...
    'b1', {phumanlist.b1},...
    'shape',{phumanlist.shape}...
    );
    phumanlist3 = struct( ...
    'human_recovery', {phumanlist.human_recovery}, ...
    'mtoh', {phumanlist.mtoh}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate*1.001}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate}, ...
    'b1', {phumanlist.b1},...
    'shape',{phumanlist.shape}...
    );
    phumanlist4 = struct( ...
    'human_recovery', {phumanlist.human_recovery}, ...
    'mtoh', {phumanlist.mtoh}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate*1.001}, ...
    'b1', {phumanlist.b1},...
    'shape',{phumanlist.shape}...
    );
    phumanlist5 = struct( ...
    'human_recovery', {phumanlist.human_recovery}, ...
    'mtoh', {phumanlist.mtoh}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate}, ...
    'b1', {phumanlist.b1*1.001},...
    'shape',{phumanlist.shape}...
    );
    phumanlist6 = struct( ...
    'human_recovery', {phumanlist.human_recovery}, ...
    'mtoh', {phumanlist.mtoh}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate}, ...
    'b1', {phumanlist.b1},...
    'shape',{phumanlist.shape*1.001}...
    );
    
    p1=spacial('nooutputfile', plistlist(1),phumanlist1,pmosquitolist,EIRS,prevalences,false,false,true,false);
    p2=spacial('nooutputfile', plistlist(1),phumanlist2,pmosquitolist,EIRS,prevalences,false,false,true,false);
    p3=spacial('nooutputfile', plistlist(1),phumanlist3,pmosquitolist,EIRS,prevalences,false,false,true,false);
    p4=spacial('nooutputfile', plistlist(1),phumanlist4,pmosquitolist,EIRS,prevalences,false,false,true,false);
    p5=spacial('nooutputfile', plistlist(1),phumanlist5,pmosquitolist,EIRS,prevalences,false,false,true,false);
    p6=spacial('nooutputfile', plistlist(1),phumanlist6,pmosquitolist,EIRS,prevalences,false,false,true,false);
    allp=((p-p1)^2+(p-p2)^2+(p-p3)^2+(p-p4)^2+(p-p5)^2+(p-p6)^2)^0.5;




    phumanlist = struct( ...
    'human_recovery', {phumanlist.human_recovery+0.01*(p-p1)/allp}, ...
    'mtoh', {phumanlist.mtoh+0.01*(p-p2)}, ...
    'immunity_gain_rate', {phumanlist.immunity_gain_rate+0.01*(p-p3)/allp}, ...
    'immunity_losing_rate', {phumanlist.immunity_losing_rate+0.01*(p-p4)/allp}, ...
    'b1', {phumanlist.b1+0.01*(p-p5)/allp},...
    'shape',{phumanlist.shape+0.1*(p-p6)/allp}...
    );
   
    i
    p
    phumanlist
    

    end

end



% input for spatial
% output videoname , drive parameter set , human parameter,
% mosquitoparameter, (EIRS ,human prevalence) for training , 
% outputto gif? =false/true, collect speed data? =true, train model? = false
% , show visual plot ?=false/true
spacial('nooutputfile.gif', plistlist(1),phumanlist,pmosquitolist,reshape(1:250,250,1),reshape(1:250,250,1),true,true,false,false)

